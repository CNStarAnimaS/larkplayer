{"version":3,"sources":["../../js/ui/progress-bar.js"],"names":["Dom","Events","document","window","ProgressBar","player","options","handleTimeUpdate","bind","handleClick","handleTouchStart","handleTouchMove","handleTouchEnd","line","$","el","lineHandle","on","percent","duration","currentTime","Math","round","style","width","event","pos","getPointerPosition","xPos","x","xPercent","console","log","touches","changedTouches","startX","originalLineWidth","parseInt","originalBarWidth","originalPaused","paused","curX","diffX","min","pause","undefined","play","off","children","forEach","child","reset","createElement","className","prototype","registerComponent"],"mappings":"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","file":"progress-bar.js","sourcesContent":["/**\n * @file progress-bar.js 视频进度条\n * @author yuhui<yuhui06@baidu.com>\n * @date 2017/11/6\n * @desc\n *    1) 目前用的 click 事件，不支持 tap 事件\n *    2) 只支持移动端拖拽，不支持 pc 端鼠标拖拽\n */\n\nimport Component from '../component';\nimport * as Dom from '../utils/dom';\nimport * as Events from '../utils/events';\nimport computedStyle from '../utils/computed-style';\n\nimport './progress-bar-except-fill';\n\nconst document = window.document;\n\nclass ProgressBar extends Component {\n    constructor(player, options) {\n        super(player, options);\n\n        this.handleTimeUpdate = this.handleTimeUpdate.bind(this);\n        this.handleClick = this.handleClick.bind(this);\n        this.handleTouchStart = this.handleTouchStart.bind(this);\n        this.handleTouchMove = this.handleTouchMove.bind(this);\n        this.handleTouchEnd = this.handleTouchEnd.bind(this);\n\n        this.line = Dom.$('.lark-progress-bar__line', this.el);\n        this.lineHandle = Dom.$('.lark-progress-bar__line__handle', this.el);\n        player.on('timeupdate', this.handleTimeUpdate);\n        this.on('click', this.handleClick);\n\n        // 拖拽\n        Events.on(this.lineHandle, 'touchstart', this.handleTouchStart);\n        Events.on(document, 'touchend', this.handleTouchEnd);\n    }\n\n    handleTimeUpdate() {\n        // 进度条\n        let percent = 0;\n        let duration = this.player.duration();\n        let currentTime = this.player.currentTime();\n        if (duration && currentTime) {\n            // 保留两位小数四舍五入\n            percent = Math.round(currentTime / duration * 100) / 100;\n            // 转换为百分数\n            percent = percent * 100 + '%';\n        }\n\n        this.line.style.width = percent;\n    }\n\n    handleClick(event) {\n        const pos = Dom.getPointerPosition(this.el, event);\n        const xPos = Math.round(pos.x * 10000) / 10000;\n        const xPercent = xPos * 100 + '%';\n        const currentTime = this.player.duration() * xPos;\n\n        // 跳到指定位置播放\n        // @todo 这里好像就直接开始播了，如果一开始视频不是播放状态，那这里是不是也不播好点\n        this.player.currentTime(currentTime);\n        // 更新 ui\n        this.line.style.width = xPercent;\n        // console.log('ProgressBar click', pos, xPos);\n    }\n\n    handleTouchStart(event) {\n        const pos = Dom.getPointerPosition(this.el, event);\n        const xPos = Math.round(pos.x * 10000) / 10000;\n        const xPercent = xPos * 100 + '%';\n\n\n        console.log('touchstart', xPercent, event);\n        const touches = event.changedTouches || event.touches;\n        // this.isHandleTouched = true;\n        this.startX = touches[0]['pageX'];\n        this.originalLineWidth = parseInt(computedStyle(this.line, 'width'), 10);\n        this.originalBarWidth = parseInt(computedStyle(this.el, 'width'), 10);\n\n        Events.on(document, 'touchmove', this.handleTouchMove);\n        Events.on(document, 'touchend', this.handleTouchEnd);\n\n        this.originalPaused = this.player.paused();\n    }\n\n    // @todo 跟 pm 确认是滑动时不断设置 currentTime 还是松手后才设置\n    handleTouchMove(event) {\n        const touches = event.changedTouches || event.touches;\n        this.curX = touches[0]['pageX'];\n        this.diffX = this.curX - this.startX;\n        const xPos = Math.round((this.originalLineWidth + this.diffX) / this.originalBarWidth * 10000) / 10000;\n        const xPercent = Math.min(xPos, 1) * 100 + '%';\n        this.line.style.width = xPercent;\n\n        // 拖动进度条的时候暂停视频，避免杂音\n        if (!this.player.paused()) {\n            this.player.pause();\n        }\n        const duration = this.player.duration();\n        this.player.currentTime(xPos * duration);\n    }\n\n    handleTouchEnd(event) {\n        // 如果播放器在拖动进度条的时候不是出于暂停状态，那么拖动完了之后继续播放\n        if (this.player.paused && !this.originalPaused && this.originalPaused !== undefined) {\n            this.player.play();\n        }\n        Events.off(document, 'touchmove', this.handleTouchMove);\n        Events.off(document, 'touchend', this.handleTouchEnd);\n    }\n\n    reset() {\n        this.line.style.width = 0;\n        this.children.forEach(child => {\n            child && child.reset && child.reset();\n        });\n    }\n\n    createEl() {\n        return Dom.createElement('div', {\n            className: 'lark-progress-bar'\n        });\n    }\n}\n\nProgressBar.prototype.options = {\n    children: ['progressBarExceptFill']\n};\n\nComponent.registerComponent('ProgressBar', ProgressBar);\n\nexport default ProgressBar;"]}